define("pages/borrow/calculator",["jquery","protocol","widgets/widgets","components/components","handlebars"],function(a){var b=a("jquery"),c=a("protocol"),d=a("widgets/widgets"),e=a("components/components"),f=a("handlebars"),g=c.translator,h=e.Calculator,i=d.Form,j=b("#borrowAmount").data("range")||"";j=j.split(",");var k=""===j[0]?"出借金额50的倍数":"金额范围"+i.comma(j[0])+"-"+i.comma(j[1]);i.validate({before:function(){""!==j[0]?jQuery.validator.addMethod("isBorrowAmount",function(a,b){return this.optional(b)||a>=parseInt(j[0],10)&&a<=parseInt(j[1],10)&&a%50===0&&/^(([1-9]{1}\d*)|([0]{1}))?$/.test(a)},"借款金额范围"+j[0]+"-"+j[1]+"，且为50的倍数"):(jQuery.validator.addMethod("isBorrowAmount",function(a,b){return this.optional(b)||a%50===0&&/^(([1-9]{1}\d*)|([0]{1}))?$/.test(a)},"出借金额范围须为50的倍数"),jQuery.validator.addMethod("isRepayDate",function(a,b){return this.optional(b)||a>0&&36>=a},"借款期限须为1-36个月")),jQuery.validator.addMethod("isRateOver",function(a){var b=""===j[0]?5:10,c=24;return a=parseFloat(a),a>=b&&c>=a},i.err.isRateOver)},showTip:!0,tip:{borrowAmount:k,yearRate:""===j[0]?"利率范围5%-24%":"利率范围10%-24%",repayDate:""===j[0]?"可填写从1到36任意整数月份":null},validateData:{submitHandler:function(a){return"借款设置"==b(".J_tit").text()&&""===b("#repayDate").attr("value")?(b(".noinput-p").css("display","block"),!1):(l(),void m(a))}}}),""===j[0]&&b("#repayDate").rules("add",{required:!0,isIntNum:!0,isRepayDate:!0,messages:{required:i.err.required,isIntNum:i.err.isIntNum}});var l=function(){var a,c,d,e;c=b("#ratetable tbody tr"),a=b.trim(b("#borrowAmount").val()),d=c.eq(0).find("td").filter(function(){return"服务费率"!=b(this).text()}),e=c.eq(1).find("td").filter(function(){return"服务费用"!=b(this).text()}),!a||a%50!==0||a>1e6?b.each(d,function(a){e.eq(a).html("")}):b.each(d,function(c){var d=parseFloat(b(this).text().replace("%",""));e.eq(c).html((d*a*.01).toFixed(0))}),b("#J_sjfy").css("color","#383838")},m=function(a){var c=b(a).serializeArray(),d=h(h.arrToObj(c)),e=d.calc();e.borrowAmount=b.trim(b("#borrowAmount").val()),e.gain=0,b.each(e.table,function(a,b){e.gain+=parseFloat(b.mlixi)}),e.gain=g._fixedFloat2(e.gain),e.monthlyRepayB=g._fixedFloat2(e.monthlyRepay+.003*e.borrowAmount),e.mounthRate=g._fixedFloat2(e.mounthRate),e.monthlyRepay=g._fixedFloat2(e.monthlyRepay),e.borrowAmount=g._fixedFloat2(e.borrowAmount),d=null;var i=b("#loan-calc").html(),j=f.compile(i);e.isShowTable="借款设置"==b(".J_tit").text()&&"false"==e.isShowTable?!1:!0,"理财计算器 "==b(".J_tit").text()&&(e.isShowTable=b("#isShowTable").is(":checked"));var k=j(e);if(b("#calcResult").html(k),b("#J_BJLX").html("<span>本金及利息</span><em>￥"+g._commaFloat(e.monthlyRepay)+"</em>&nbsp;&nbsp;(支付给理财人)"),b("#J_JKGLF").html("<span>借款管理费</span><em>￥"+g._commaFloat(.003*e.borrowAmount)+"</em>&nbsp;&nbsp;(由人人贷平台收取)"),"借款设置"==b(".J_tit").text()){var l=b("#calcForm").offset();b("body,html").animate({scrollTop:l.top},0)}};b(document).click(function(a){var c=a.target;b(c).parent("span").hasClass("arrow")||b(c).parent("div").hasClass("J_select_btn")||b(".J_popBox").css("display","none")}),b(".J_select_btn").click(function(a){b(".J_popBox").css("display","none");var c=b(a.currentTarget).parent().find("ul");"block"==c.css("display")?c.css("display","none"):c.css("display","block")}),b(".J_popBox li").mouseover(function(a){b(a.currentTarget).attr("class","selected")}),b(".J_popBox li").mouseleave(function(a){b(a.currentTarget).attr("class","")}),b(".J_popBox li").click(function(a){var c=b(a.currentTarget).attr("datavalue"),d=b(a.currentTarget).find("span").text(),e=b(a.currentTarget).parent().parent();if(e.find("input").attr("value",c),e.find(".J_txt").text(d),"RRGXD"==c||"RRSYD"==c||"RRWSD"==c)return location.href="/borrow/calculator.action?prodType="+c,!1;switch(b(".noinput-p").css("display","none"),c){case"3":b("#yearRate").val("10"),b("#yearRate").parent().find(".error-p").css("display","none");break;case"6":b("#yearRate").val("11"),b("#yearRate").parent().find(".error-p").css("display","none");break;case"9":b("#yearRate").val("12"),b("#yearRate").parent().find(".error-p").css("display","none");break;case"12":b("#yearRate").val("13"),b("#yearRate").parent().find(".error-p").css("display","none");break;case"15":b("#yearRate").val("13"),b("#yearRate").parent().find(".error-p").css("display","none");break;case"18":b("#yearRate").val("13"),b("#yearRate").parent().find(".error-p").css("display","none");break;case"24":b("#yearRate").val("13"),b("#yearRate").parent().find(".error-p").css("display","none");break;case"36":b("#yearRate").val("13"),b("#yearRate").parent().find(".error-p").css("display","none")}}),b("#yearRate,#borrowAmount,.error-p").on("click",function(a){b(a.currentTarget).parent().find(".error-p").css("display","none")}),b(".J_ui_checkbox").bind("click",function(a){var c=b(a.currentTarget);c.hasClass("uncheck")?(c.removeClass("uncheck"),c.addClass("check"),b("#isShowTable").attr("value","true")):(c.removeClass("check"),c.addClass("uncheck"),b("#isShowTable").attr("value","false"))})});